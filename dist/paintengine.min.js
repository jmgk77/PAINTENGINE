var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
var PaintEngine=function(a){this.user=a;if(!this.user.sketch_canvas)throw"PaintEngine::constructor(): <sketch_canvas> must be defined";if(!this.user.sketch_files)throw"PaintEngine::constructor(): <sketch_files> must be defined";if(!this.user.sketch_files.length)throw"PaintEngine::constructor(): <sketch_files> must be have at least 1 element";this.max_sketchs=this.user.sketch_files.length-1;this.cur_sketch=0;this.user.color||(this.user.color={r:128,g:0,b:128,a:255});this.user.color_blocklist||(this.user.color_blocklist=
[{r:0,g:0,b:0,a:255}]);this.user.color_transparency||(this.user.color_transparency=[{r:255,g:255,b:255,a:255}]);if(this.user.sticker_canvas&&this.user.current_sticker_canvas){a=document.getElementById(this.user.current_sticker_canvas);var b=document.getElementById(this.user.sticker_canvas);this.sticker_scale_x=a.width/(b.width/this.user.sticker_x);this.sticker_scale_y=a.height/(b.height/this.user.sticker_y)}this.history_a=[];this.history_ptr=0;this.tool=null};
PaintEngine.prototype.run=function(){document.getElementById(this.user.sketch_canvas).onclick=function(a){this.tool(a)}.bind(this);this.user.prev_btn_id&&(document.getElementById(this.user.prev_btn_id).onclick=function(){this.load_sketch(-1)}.bind(this));this.user.next_btn_id&&(document.getElementById(this.user.next_btn_id).onclick=function(){this.load_sketch(1)}.bind(this));this.user.reload_btn_id&&(document.getElementById(this.user.reload_btn_id).onclick=function(){this.load_sketch(0)}.bind(this));
this.user.undo_btn_id&&(document.getElementById(this.user.undo_btn_id).onclick=function(){this.back_history()}.bind(this));this.user.redo_btn_id&&(document.getElementById(this.user.redo_btn_id).onclick=function(){this.redo_history()}.bind(this));this.user.paint_btn_id&&(document.getElementById(this.user.paint_btn_id).onclick=function(){this.paint()}.bind(this));this.user.erase_btn_id&&(document.getElementById(this.user.erase_btn_id).onclick=function(){this.erase()}.bind(this));this.user.eyedrop_btn_id&&
(document.getElementById(this.user.eyedrop_btn_id).onclick=function(){this.eyedrop()}.bind(this));this.user.sticker_btn_id&&(document.getElementById(this.user.sticker_btn_id).onclick=function(){this.sticker()}.bind(this));this.load_sketch(0);this.paint_color=this.user.color;this.paint()};
PaintEngine.prototype.load_sketch=function(a){var b=document.getElementById(this.user.sketch_canvas),c=b.getContext("2d"),e=new Image;e.onload=function(){c.imageSmoothingEnabled=!1;c.drawImage(e,0,0,b.width,b.height)};this.cur_sketch+=a;this.cur_sketch=0>this.cur_sketch?this.max_sketchs:this.cur_sketch>this.max_sketchs?0:this.cur_sketch;e.src=this.user.sketch_files[this.cur_sketch];this.history_a.length=0};
PaintEngine.prototype.back_history=function(){this.history_a.length&&0<this.history_ptr&&(this.history_a.length==this.history_ptr&&(this.history_a[this.history_ptr]=document.getElementById(this.user.sketch_canvas).toDataURL("image/png")),this.history_ptr--,this._canvas_history_update())};PaintEngine.prototype.redo_history=function(){this.history_a.length&&this.history_ptr<this.history_a.length&&(this.history_ptr++,this._canvas_history_update())};
PaintEngine.prototype._canvas_history_update=function(){var a=document.getElementById(this.user.sketch_canvas).getContext("2d"),b=new Image;b.onload=function(){a.imageSmoothingEnabled=!1;a.drawImage(b,0,0)};b.src=this.history_a[this.history_ptr]};PaintEngine.prototype._save_history=function(){this.history_a[this.history_ptr]=document.getElementById(this.user.sketch_canvas).toDataURL("image/png");this.history_a.length=++this.history_ptr};
PaintEngine.prototype._show_current_color=function(){if(this.user.current_color_canvas){var a=document.getElementById(this.user.current_color_canvas),b=a.getContext("2d");b.fillStyle="rgba("+this.user.color.r+","+this.user.color.g+","+this.user.color.b+","+this.user.color.a+")";b.fillRect(0,0,a.width,a.height)}};
PaintEngine.prototype._show_border=function(a){this.user.css_class_border&&(this.user.erase_btn_id&&document.getElementById(this.user.erase_btn_id).classList.remove(this.user.css_class_border),this.user.paint_btn_id&&document.getElementById(this.user.paint_btn_id).classList.remove(this.user.css_class_border),this.user.eyedrop_btn_id&&document.getElementById(this.user.eyedrop_btn_id).classList.remove(this.user.css_class_border),this.user.sticker_btn_id&&document.getElementById(this.user.sticker_btn_id).classList.remove(this.user.css_class_border),
a&&document.getElementById(a).classList.add(this.user.css_class_border))};PaintEngine.prototype.erase=function(){this._show_border(this.user.erase_btn_id);this.tool=this.bucket_tool;this.user.color={r:255,g:255,b:255,a:255};this._show_current_color()};PaintEngine.prototype.eyedrop=function(){this._show_border(this.user.eyedrop_btn_id);this.tool=this.eyedropper_tool};PaintEngine.prototype.eyedropper_tool=function(a){this._get_color_xy(this.user.sketch_canvas,a)};
PaintEngine.prototype._get_color_xy=function(a,b){a=document.getElementById(a).getContext("2d").getImageData(b.offsetX,b.offsetY,1,1);a={r:a.data[0],g:a.data[1],b:a.data[2],a:a.data[3]};this._check_color_in_list(a,this.user.color_blocklist)||(this.paint_color=this.user.color=a,this.paint())};PaintEngine.prototype._check_color_in_list=function(a,b){for(var c=0;c<b.length;c++)if(a.r===b[c].r&&a.g===b[c].g&&a.b===b[c].b)return!0;return!1};
PaintEngine.prototype.paint=function(){this._show_border(this.user.paint_btn_id);this.tool=this.bucket_tool;this.user.color=this.paint_color;this._show_current_color();if(this.user.palette_canvas&&this.user.palette_file){var a=document.getElementById(this.user.palette_canvas),b=a.getContext("2d"),c=new Image;c.onload=function(){b.imageSmoothingEnabled=!1;b.drawImage(c,0,0,a.width,a.height)};c.src=this.user.palette_file;document.getElementById(this.user.palette_canvas).onclick=function(a){this.color_picker(a)}.bind(this)}};
PaintEngine.prototype.color_picker=function(a){this._get_color_xy(this.user.palette_canvas,a)};
PaintEngine.prototype.bucket_tool=function(a){var b=document.getElementById(this.user.sketch_canvas),c=b.getContext("2d"),e=[{x:a.offsetX,y:a.offsetY}],f=c.getImageData(0,0,b.width,b.height),d=4*(a.offsetY*b.width+a.offsetX),h={r:f.data[d],g:f.data[d+1],b:f.data[d+2],a:f.data[d+3]};a=[].concat($jscomp.arrayFromIterable(this.user.color_blocklist),[this.user.color]);if(!this._check_color_in_list(h,a)){a=function(a){return f.data[d+0+a]==h.r&&f.data[d+1+a]==h.g&&f.data[d+2+a]==h.b&&f.data[d+3+a]==h.a};
for(this._save_history();0<e.length;){var g=e.pop(),k=g.x;g=g.y;for(d=4*(g*b.width+k);0<=g--&&a(0);)d-=4*b.width;d+=4*b.width;g++;for(var l=!1,m=!1;g++<b.height&&a(0);)f.data[d]=this.user.color.r,f.data[d+1]=this.user.color.g,f.data[d+2]=this.user.color.b,f.data[d+3]=this.user.color.a,0<k&&(a(-4)?l||(e.push({x:k-1,y:g}),l=!0):l&&(l=!1)),k<b.width-1&&(a(4)?m||(e.push({x:k+1,y:g}),m=!0):m&&(m=!1)),d+=4*b.width}c.putImageData(f,0,0)}};
PaintEngine.prototype.sticker=function(){if(this.user.sticker_canvas&&this.user.sticker_file&&this.user.sticker_x&&this.user.sticker_y){this._show_border(this.user.sticker_btn_id);this.tool=this.sticker_tool;this._show_sticker();var a=document.getElementById(this.user.sticker_canvas),b=a.getContext("2d");b.fillStyle="white";b.fillRect(0,0,a.width,a.height);var c=new Image;c.onload=function(){b.imageSmoothingEnabled=!1;b.drawImage(c,0,0,a.width,a.height)};c.src=this.user.sticker_file;this.sticker_size_x=
a.width/this.user.sticker_x;this.sticker_size_y=a.height/this.user.sticker_y;document.getElementById(this.user.sticker_canvas).onclick=function(a){this.sticker_picker(a)}.bind(this)}};
PaintEngine.prototype.sticker_tool=function(a){if(this.temp_sticker_canvas){var b=document.getElementById(this.user.sketch_canvas),c=b.getContext("2d"),e=c.getImageData(0,0,b.width,b.height);this._check_color_in_list({r:e.data[4*(a.offsetY*b.width+a.offsetX)],g:e.data[4*(a.offsetY*b.width+a.offsetX)+1],b:e.data[4*(a.offsetY*b.width+a.offsetX)+2],a:e.data[4*(a.offsetY*b.width+a.offsetX)+3]},this.user.color_blocklist)||(this._save_history(),c.imageSmoothingEnabled=!1,c.drawImage(this.temp_sticker_canvas,
a.offsetX-this.sticker_size_x/2,a.offsetY-this.sticker_size_y/2))}};PaintEngine.prototype._show_sticker=function(){if(this.user.current_sticker_canvas){var a=document.getElementById(this.user.current_sticker_canvas),b=a.getContext("2d");b.fillStyle="white";b.fillRect(0,0,a.width,a.height);this.temp_sticker_canvas&&(b.save(),1!=this.sticker_scale_x&&1!=this.sticker_scale_y&&b.scale(this.sticker_scale_x,this.sticker_scale_y),b.imageSmoothingEnabled=!1,b.drawImage(this.temp_sticker_canvas,0,0),b.restore())}};
PaintEngine.prototype.sticker_picker=function(a){var b=Math.floor(a.offsetX/this.sticker_size_x)*this.sticker_size_x;a=Math.floor(a.offsetY/this.sticker_size_y)*this.sticker_size_y;b=document.getElementById(this.user.sticker_canvas).getContext("2d").getImageData(b,a,this.sticker_size_x,this.sticker_size_y);this.temp_sticker_canvas=document.createElement("canvas");this.temp_sticker_canvas.width=b.width;this.temp_sticker_canvas.height=b.height;a=b.data;for(var c=0;c<a.length;c+=4)this._check_color_in_list({r:a[c+
0],g:a[c+1],b:a[c+2],a:a[c+3]},this.user.color_transparency)&&(a[c+3]=0);this.temp_sticker_canvas.getContext("2d").putImageData(b,0,0);this.sticker()};$jscomp.global.Object.defineProperties(PaintEngine.prototype,{color:{configurable:!0,enumerable:!0,set:function(a){this.user.color=a}}});
